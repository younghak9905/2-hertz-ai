import os
import re
import time
from datetime import datetime

import google.generativeai as genai
import pandas as pd
from candidates import SAMPLE_NEWS
from dotenv import load_dotenv

load_dotenv()

GEMINI_API_KEY = os.getenv("GOOGLE_API_KEY")
genai.configure(api_key=GEMINI_API_KEY)

model = genai.GenerativeModel("gemini-2.5-flash")


def create_evaluation_prompt(sample_data):
    """í‰ê°€ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±"""
    sample_json = (
        f'{{"title": "{sample_data["title"]}", "content": "{sample_data["content"]}"}}'
    )

    prompt = f"""
ë‹¹ì‹ ì€ ì†Œì…œ ë””ìŠ¤ì»¤ë²„ë¦¬ ì•±ì˜ ë§¤ì¹­ ë‰´ìŠ¤ í’ˆì§ˆì„ í‰ê°€í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ğŸ“‹ í‰ê°€ ì›ì¹™
- **êµ¬ì²´ì  ê°œì„ ì  ì œì‹œ**: ë§Œì ì´ ì•„ë‹Œ ëª¨ë“  í•­ëª©ì— ëŒ€í•´ ëª…í™•í•œ ê°œì„  ë°©í–¥ ì œì‹œ í•„ìˆ˜
- **í†µí•©ì  í‰ê°€**: ê¸ì •ì  ìš”ì†Œì™€ ë¶€ì •ì  ìš”ì†Œë¥¼ ì¢…í•©í•˜ì—¬ í•˜ë‚˜ì˜ ì ìˆ˜ë¡œ í‰ê°€
- **ë§Œì  ë¶€ì—¬ ê¸°ì¤€**: í˜ì‹ ì ì´ê³  ì™„ë²½ë¬´ê²°í•œ ìˆ˜ì¤€ì—ë§Œ ë§Œì  ë¶€ì—¬
- **ìŠ¤í† ë¦¬ ì¤‘ì‹¬ì˜ í‰ê°€ ì›ì¹™**:'ë‰´ìŠ¤', 'ì†Œì„¤', 'ì‹œ' ë“± ì–´ë–¤ ì°½ì˜ì ì¸ í˜•ì‹ì„ ì‚¬ìš©í•˜ë”ë¼ë„, ê·¸ê²ƒì´ ì œê³µëœ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§¤ë ¥ì ì¸ ìŠ¤í† ë¦¬ë¥¼ êµ¬ì„±í•˜ê³  ë…ìì˜ í¥ë¯¸ë¥¼ ìœ ë°œí•˜ëŠ” ìµœì¢… ëª©ì ì— ê¸°ì—¬í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ í‰ê°€í•˜ì‹­ì‹œì˜¤. í˜•ì‹ì´ ë…ì°½ì ì´ë”ë¼ë„ ë°ì´í„° ê¸°ë°˜ì˜ ìŠ¤í† ë¦¬í…”ë§ì´ ë¹ˆì•½í•˜ë‹¤ë©´ ë†’ì€ ì ìˆ˜ë¥¼ ë¶€ì—¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- **ìƒì¶© ìš”ì†Œ íŒë‹¨ ì›ì¹™**: í•˜ë‚˜ì˜ íŠ¹ì§•ì´ ë‹¤ë¥¸ ì§€í‘œì—ì„œëŠ” ì¥ì , ë‹¤ë¥¸ ì§€í‘œì—ì„œëŠ” ë‹¨ì ì´ ë  ê²½ìš°, ê° ì§€í‘œë¥¼ ë…ë¦½ì ìœ¼ë¡œ í‰ê°€

---

## ğŸ¯ í‰ê°€ì§€í‘œ (ì´ 32ì )

### 1. í¥ë¯¸ë„ ë° ëª°ì…ê° (6ì )
ë…ìì˜ ê´€ì‹¬ì„ ëŒê³  ëê¹Œì§€ ì½ê²Œ ë§Œë“œëŠ” ë§¤ë ¥ì ì¸ ì½˜í…ì¸  ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 6ì : í˜ì‹ ì ì´ê³  ë…ì°½ì ì¸ ì ‘ê·¼ìœ¼ë¡œ ë…ìë¥¼ ì™„ì „íˆ ëª°ì…ì‹œí‚´. ì—…ê³„ ìµœê³  ìˆ˜ì¤€ì˜ ì°½ì˜ì„±ê³¼ ìŠ¤í† ë¦¬í…”ë§
- 5ì : ë§¤ìš° í¥ë¯¸ë¡­ê³  ë…ì°½ì ì´ë‚˜, ì¼ë¶€ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ìš”ì†Œë‚˜ ë¯¸ì„¸í•œ ì•„ì‰¬ì›€ ì¡´ì¬
- 4ì : ì¶©ë¶„íˆ í¥ë¯¸ë¡­ê³  ì½ì„ ë§Œí•˜ë‚˜, íŠ¹ë³„í•¨ì´ë‚˜ ë…ì°½ì„± ë¶€ì¡±
- 3ì : ê¸°ë³¸ì ì¸ í¥ë¯¸ëŠ” ìœ ë°œí•˜ë‚˜, ì„íŒ©íŠ¸ë‚˜ ì°¨ë³„í™” ìš”ì†Œ ì œí•œì 
- 2ì : ë‹¤ì†Œ í¥ë¯¸ë¡œìš°ë‚˜ ì§‘ì¤‘ë ¥ ìœ ì§€ ì–´ë ¤ì›€, ë»”í•œ ë‚´ìš©ì´ ë§ìŒ
- 1ì : í¥ë¯¸ê°€ ë–¨ì–´ì§€ê³  ì§€ë£¨í•¨, ë…ì ì´íƒˆ ê°€ëŠ¥ì„± ë†’ìŒ

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ ë…ì°½ì ì´ê³  ì‹ ì„ í•œ ì ‘ê·¼ ë°©ì‹, ì˜ˆìƒì„ ë’¤ì—ëŠ” ì „ê°œë‚˜ ê´€ì 
- âœ— ë°˜ë³µì ì´ê±°ë‚˜ ì§„ë¶€í•œ í‘œí˜„ ì‚¬ìš©, ì–´ìƒ‰í•˜ê±°ë‚˜ ë¶€ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì²´

### 2. ì •ë³´ í’ë¶€í•¨ (5ì )
ë‹¤ì–‘í•˜ê³  ì‹¤ìš©ì ì¸ ì •ë³´ ì œê³µ ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 5ì : ë§¤ìš° ë‹¤ì–‘í•˜ê³  ì‹¬ì¸µì ì¸ ì •ë³´, ìµœì‹  íŠ¸ë Œë“œì™€ ì‹¤ìš©ì  ì¡°ì–¸ì´ ì™„ë²½í•˜ê²Œ ì¡°í™”
- 4ì : í’ë¶€í•˜ê³  ìœ ìš©í•œ ì •ë³´ ì œê³µ, ì¼ë¶€ ì˜ì—­ì—ì„œ ê¹Šì´ ë¶€ì¡±
- 3ì : ê¸°ë³¸ì ì¸ ì •ë³´ëŠ” ì¶©ì¡±í•˜ë‚˜, ë‹¤ì–‘ì„±ì´ë‚˜ ê¹Šì´ ì œí•œì 
- 2ì : ì •ë³´ëŸ‰ì´ ë¶€ì¡±í•˜ê±°ë‚˜ í”¼ìƒì , ì‹¤ìš©ì„± ë–¨ì–´ì§
- 1ì : ì •ë³´ê°€ ë§¤ìš° ë¶€ì¡±í•˜ê³  ë‚´ìš©ì´ ë¹ˆì•½

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ ì •í™•í•˜ê³  ìµœì‹ ì˜ ì •ë³´ ì œê³µ, ì‹¤ìš©ì ì´ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸
- âœ— ë¶€ì •í™•í•˜ê±°ë‚˜ ì˜¤ë˜ëœ ì •ë³´ í¬í•¨, ì‹œì˜ì„±ì´ ë–¨ì–´ì§€ëŠ” ë‚´ìš©

### 3. ê°œì¸í™” ë° ìŠ¤í† ë¦¬í…”ë§ (4ì )
ê°œì¸ ì •ë³´ë¥¼ í™œìš©í•œ ë§¤ë ¥ì ì¸ ìŠ¤í† ë¦¬ êµ¬ì„± ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 4ì : ì‚¬ìš©ì ì •ë³´ë¥¼ ë§¤ìš° ì°½ì˜ì ìœ¼ë¡œ í™œìš©í•˜ì—¬, ë‘ ì¸ë¬¼ì˜ ê´€ê³„ë‚˜ íŠ¹ì„±ì´ ìƒìƒí•˜ê²Œ ë“œëŸ¬ë‚˜ëŠ” í•˜ë‚˜ì˜ ì™„ë²½í•œ ìŠ¤í† ë¦¬ë¥¼ ì™„ì„±í•¨. ë°ì´í„°ê°€ ì„œì‚¬ì˜ í•µì‹¬ ë™ë ¥ì´ ë˜ì–´ ë…ìì˜ ëª°ì…ê°ì„ ê·¹ëŒ€í™”ì‹œí‚´.
- 3ì : ì‚¬ìš©ì ì •ë³´ë¥¼ ì˜ í™œìš©í•˜ì—¬ ê´€ê³„ì˜ íŠ¹ì§•ì„ ì„¤ëª…í•˜ê³  ìŠ¤í† ë¦¬ë¥¼ êµ¬ì„±í–ˆìœ¼ë‚˜, ì¼ë¶€ ë°ì´í„°ê°€ ë‹¨ìˆœ ë‚˜ì—´ë˜ê±°ë‚˜ ì„œì‚¬ì  ì—°ê²°ì´ ë‹¤ì†Œ ë¶€ì¡±í•˜ì—¬ ê¹Šì´ê°€ ì•„ì‰¬ì›€.
- 2ì : ì‚¬ìš©ì ì •ë³´ë¥¼ í™œìš©í–ˆì§€ë§Œ, ìŠ¤í† ë¦¬í…”ë§ë³´ë‹¤ëŠ” ë‹¨ìˆœ ì •ë³´ ë‚˜ì—´ì´ë‚˜ ë¶„ì„ì— ê·¸ì¹¨. ë…ìê°€ ê´€ê³„ì˜ íë¦„ì´ë‚˜ ê°ì •ì„ ëŠë¼ê¸° ì–´ë ¤ì›€.
- 1ì : ì‚¬ìš©ì ì •ë³´ í™œìš©ì´ ë§¤ìš° ì œí•œì ì´ê±°ë‚˜, ìŠ¤í† ë¦¬ êµ¬ì„± ì—†ì´ ë‹¨í¸ì ì¸ ì‚¬ì‹¤ë§Œ ì œì‹œ.

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ ì‚¬ìš©ì ë°ì´í„°(MBTI, ê´€ì‹¬ì‚¬, ëŒ€í™” íšŸìˆ˜ ë“±)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ë¬¼ì˜ ê°œì„±ì´ë‚˜ ê´€ê³„ì˜ ì—­ë™ì„±ì„ ìƒìƒí•˜ê²Œ ë¬˜ì‚¬
- âœ“ ë°ì´í„°ì™€ ìŠ¤í† ë¦¬ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ìœµí•©ë˜ì–´, ë…ìê°€ 'ë‘ ì‚¬ëŒ'ì˜ ì´ì•¼ê¸°ì— í¥ë¯¸ë¥¼ ëŠë¼ê³  ëª°ì… ê°€ëŠ¥
- âœ“ ë‹¨ìˆœí•œ ì •ë³´ ì „ë‹¬ì„ ë„˜ì–´, ê´€ê³„ì— ëŒ€í•œ ë§¤ë ¥ì ì¸ ì„œì‚¬(ë‚´ëŸ¬í‹°ë¸Œ) ë¶€ì—¬
- âœ— ë°ì´í„°ê°€ ìŠ¤í† ë¦¬ì™€ ë¶„ë¦¬ë˜ì–´ ë‹¨ìˆœ ë‚˜ì—´ë˜ê±°ë‚˜, ê¸°ê³„ì ìœ¼ë¡œ ë¶„ì„ë¨
- âœ— ëˆ„êµ¬ì—ê²Œë‚˜ ì ìš©ë  ìˆ˜ ìˆëŠ” ì¼ë°˜ì ì¸ ì„¤ëª…ì— ê·¸ì¹¨
- âœ— ìŠ¤í† ë¦¬ì˜ ê¸°ìŠ¹ì „ê²°ì´ë‚˜ ê°ì •ì„  ì—†ì´, ê±´ì¡°í•œ ë³´ê³ ì„œ í˜•ì‹ì— ê°€ê¹Œì›€

### 4. ì—”í„°í…Œì¸ë¨¼íŠ¸ ê°€ì¹˜ (3ì )
ì¬ë¯¸ì™€ ì¦ê±°ì›€ì„ ì£¼ëŠ” ì˜¤ë½ì  ìš”ì†Œ ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 3ì : ë§¤ìš° ì¬ë¯¸ìˆê³  ë…ì°½ì ì¸ ìœ ë¨¸, ìœ„íŠ¸ê°€ ë›°ì–´ë‚˜ë©° ì˜¤ë½ì  ê°€ì¹˜ ìµœê³  ìˆ˜ì¤€
- 2ì : ì¬ë¯¸ìˆê³  ì¦ê±°ìš´ ìš”ì†Œê°€ ì ì ˆíˆ í¬í•¨ë˜ë‚˜, ì„íŒ©íŠ¸ë‚˜ ë…ì°½ì„± ë¶€ì¡±
- 1ì : ê¸°ë³¸ì ì¸ ì¬ë¯¸ ìš”ì†ŒëŠ” ìˆìœ¼ë‚˜ ë°‹ë°‹í•˜ê³  ì˜ˆì¸¡ ê°€ëŠ¥

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ ìì—°ìŠ¤ëŸ½ê³  ì ì ˆí•œ ìœ ë¨¸ì™€ ìœ„íŠ¸, ë…ìë¥¼ ì¦ê²ê²Œ í•˜ëŠ” ì°½ì˜ì  ìš”ì†Œ
- âœ— ë¶€ì ì ˆí•˜ê±°ë‚˜ ì–´ìƒ‰í•œ ìœ ë¨¸ ì‹œë„

### 5. ê°€ë…ì„± ë° êµ¬ì„± (2ì )
ì½ê¸° ì‰¬ì›€ê³¼ ì‹œê°ì  ë§¤ë ¥ ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 2ì : ì™„ë²½í•œ ê°€ë…ì„±ê³¼ ì‹œê°ì  ë§¤ë ¥, ì´ëª¨ì§€ì™€ ì„œì‹ í™œìš©ì´ íƒì›”í•˜ê³  ì •ë³´ ì „ë‹¬ ìµœì í™”
- 1ì : ê¸°ë³¸ì ì¸ ê°€ë…ì„±ì€ ê°–ì¶”ì—ˆìœ¼ë‚˜, ì‹œê°ì  ë§¤ë ¥ì´ë‚˜ êµ¬ì„±ì— ì•„ì‰¬ì›€

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ ì ì ˆí•œ ì´ëª¨ì§€ì™€ ì„œì‹ í™œìš©, ë…¼ë¦¬ì ì´ê³  ì¼ê´€ëœ êµ¬ì„±
- âœ— ê³¼ë„í•œ ì´ëª¨ì§€ ì‚¬ìš©ìœ¼ë¡œ ê°€ë…ì„± ì €í•´, êµ¬ì„±ì´ ì‚°ë§Œí•˜ê±°ë‚˜ ì¼ê´€ì„± ë¶€ì¡±

### 6. ì˜ˆì¸¡ ë° ê¸°ëŒ€ê° ì¡°ì„± (5ì )
ì•ìœ¼ë¡œì˜ ê´€ê³„ ë°œì „ì„ ë…ìê°€ ìƒìƒí•˜ê³  ê¸°ëŒ€í•˜ê²Œ ë§Œë“œëŠ” ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 5ì : í˜ì‹ ì ì´ê³  ê¸°ë°œí•œ ìƒìƒë ¥ìœ¼ë¡œ ë…ìì—ê²Œ í­ë°œì ì¸ ê¸°ëŒ€ê°ê³¼ í˜¸ê¸°ì‹¬ ìœ ë°œ
- 4ì : í¥ë¯¸ë¡œìš´ ë¯¸ë˜ ì˜ˆì¸¡ê³¼ êµ¬ì²´ì ì¸ í™œë™ ì œì•ˆìœ¼ë¡œ ì ì ˆí•œ ê¸°ëŒ€ê° ì¡°ì„±
- 3ì : ê¸°ë³¸ì ì¸ ë¯¸ë˜ ì˜ˆì¸¡ì´ë‚˜ ì œì•ˆì€ ìˆìœ¼ë‚˜, íŠ¹ë³„í•¨ì´ë‚˜ ì°½ì˜ì„± ë¶€ì¡±
- 2ì : ë¯¸ë˜ ì˜ˆì¸¡ì´ ëª¨í˜¸í•˜ê±°ë‚˜ ì¼ë°˜ì , ê¸°ëŒ€ê° ì¡°ì„± ì œí•œì 
- 1ì : ë¯¸ë˜ì— ëŒ€í•œ ì–¸ê¸‰ì´ë‚˜ ê¸°ëŒ€ê° ì¡°ì„±ì´ ê±°ì˜ ì—†ìŒ

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ êµ¬ì²´ì ì´ê³  ì‹¤í˜„ ê°€ëŠ¥í•œ ë¯¸ë˜ ì‹œë‚˜ë¦¬ì˜¤ ì œì‹œ, ë…ìì˜ í˜¸ê¸°ì‹¬ê³¼ ê¸°ëŒ€ê°ì„ ìê·¹í•˜ëŠ” ì°½ì˜ì  ì œì•ˆ
- âœ— í˜„ì‹¤ì„±ì´ ë–¨ì–´ì§€ê±°ë‚˜ ë„ˆë¬´ ë»”í•œ ì˜ˆì¸¡

### 7. ê³µê°ëŒ€ í˜•ì„± ë° ê´€ê³„ì— ëŒ€í•œ ê°ì„±ì  ëª°ì… (4ì )
ë…ìê°€ ë¦¬í¬íŠ¸ ì† ì¸ë¬¼ë“¤ì˜ ê´€ê³„ì™€ ê°ì •ì„ ì— ê³µê°í•˜ê³ , ê·¸ë“¤ì˜ ë¯¸ë˜ë¥¼ ì‘ì›í•˜ê³  ì‹¶ê²Œ ë§Œë“œëŠ” ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 4ì : ì¸ë¬¼ë“¤ì˜ ê´€ê³„ì™€ ê°ì •ì„ ì— ëŒ€í•œ ë¬˜ì‚¬ê°€ ë§¤ìš° ë›°ì–´ë‚˜, ë…ìê°€ ë§ˆì¹˜ ìì‹ ì˜ ì¹œêµ¬ ì´ì•¼ê¸°ì²˜ëŸ¼ ê¹Šì´ ëª°ì…í•˜ê³  ê·¸ë“¤ì˜ ê´€ê³„ë¥¼ ì§„ì‹¬ìœ¼ë¡œ ì‘ì›í•˜ê²Œ ë§Œë“¦.
- 3ì : ì¸ë¬¼ë“¤ì˜ íŠ¹ì§•ê³¼ ìƒí™©ì„ í†µí•´, ë…ìê°€ ê·¸ë“¤ì˜ ê´€ê³„ì— ê¸ì •ì ì¸ ê°ì •ì„ ëŠë¼ê³  ê³µê°ëŒ€ë¥¼ í˜•ì„±í•¨.
- 2ì : ì¸ë¬¼ë“¤ì˜ ê´€ê³„ì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ì„¤ëª…ì€ ìˆìœ¼ë‚˜, ê°ì • ë¬˜ì‚¬ê°€ ë¶€ì¡±í•˜ì—¬ ê¹Šì€ ê³µê°ì´ë‚˜ ëª°ì…ì„ ì´ëŒì–´ë‚´ê¸° ì–´ë ¤ì›€.
- 1ì : ì¸ë¬¼ ë¬˜ì‚¬ê°€ í”¼ìƒì ì´ì–´ì„œ ë…ìê°€ ê´€ê³„ì— ëŒ€í•´ ì•„ë¬´ëŸ° ê°í¥ì„ ëŠë¼ê¸° ì–´ë ¤ì›€.

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ ì¸ë¬¼ë“¤ì˜ ê°ì •ì´ë‚˜ ê´€ê³„ì˜ ì—­ë™ì„±(ë‹¤ì´ë‚´ë¯¹)ì— ëŒ€í•œ ì„¬ì„¸í•œ ë¬˜ì‚¬
- âœ“ ë…ìê°€ 'ì´ ë‘ ì‚¬ëŒ, ì •ë§ ì˜ ëìœ¼ë©´ ì¢‹ê² ë‹¤'ë¼ê³  ëŠë¼ê²Œ ë§Œë“œëŠ” ê¸ì •ì  ì„œì‚¬
- âœ“ ë…ìê°€ ìì‹ ì˜ ì—°ì• ë‚˜ ìš°ì • ê²½í—˜ì„ ë– ì˜¬ë¦¬ë©° ë³´í¸ì ì¸ ê³µê°ëŒ€ë¥¼ í˜•ì„±í•  ìˆ˜ ìˆëŠ” ìš”ì†Œ
- âœ— ì¸ë¬¼ ë¬˜ì‚¬ê°€ í”¼ìƒì ì´ê±°ë‚˜ ê´€ê³„ì— ëŒ€í•œ ë¶„ì„ì´ ê±´ì¡°í•¨
- âœ— ë…ìê°€ ê´€ê³„ì˜ ë°œì „ì— ëŒ€í•´ ë¬´ê´€ì‹¬í•˜ê²Œ ë§Œë“œëŠ” ì„œìˆ 

### 8. ë°ì´í„° í™œìš©ì˜ ì°½ì˜ì„± (3ì )
ì£¼ì–´ì§„ ë°ì´í„°ë¥¼ ì°½ì˜ì ì´ê³  ì¬ì¹˜ ìˆê²Œ í•´ì„í•˜ê³  í™œìš©í•œ ì •ë„

**ì ìˆ˜ ê¸°ì¤€:**
- 3ì : ë°ì´í„°ë¥¼ ë§¤ìš° ì°½ì˜ì ì´ê³  í˜ì‹ ì ì¸ ë°©ì‹ìœ¼ë¡œ í•´ì„í•˜ì—¬ ìŠ¤í† ë¦¬ì— ì™„ë²½í•˜ê²Œ ìœµí•©
- 2ì : ë°ì´í„°ë¥¼ í¥ë¯¸ë¡­ê²Œ í™œìš©í•˜ë ¤ëŠ” ì‹œë„ê°€ ë³´ì´ë‚˜, ì°½ì˜ì„±ì´ë‚˜ ì™„ì„±ë„ ì•„ì‰¬ì›€
- 1ì : ë°ì´í„° í™œìš©ì´ í”¼ìƒì ì´ê±°ë‚˜ ê¸°ê³„ì , ì°½ì˜ì„± ë¶€ì¡±

**í‰ê°€ ì‹œ ê³ ë ¤ì‚¬í•­:**
- âœ“ ë°ì´í„°ì˜ ì°½ì˜ì ì´ê³  ë…íŠ¹í•œ í•´ì„, ë°ì´í„°ì™€ ìŠ¤í† ë¦¬ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ì—°ê²°
- âœ— ë°ì´í„° ì˜¤í•´ì„ì´ë‚˜ ì™œê³¡, ë‹¨ìˆœ ë‚˜ì—´ì‹ ë°ì´í„° í™œìš©

---

## ğŸ“ í‰ê°€ ëŒ€ìƒ í…ìŠ¤íŠ¸
{sample_json}

---

## ğŸ“‹ ì¶œë ¥ í˜•ì‹
ë°˜ë“œì‹œ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œë§Œ ë‹µë³€í•´ì£¼ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ ì •í™•íˆ ì´ í˜•ì‹ì„ ë”°ë¼ì£¼ì„¸ìš”:

**í‰ê°€ ëŒ€ìƒ:**
[title ë‚´ìš©]

**í‰ê°€ ê²°ê³¼:**
1. í¥ë¯¸ë„ ë° ëª°ì…ê°: (ì ìˆ˜)/6ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

2. ì •ë³´ í’ë¶€í•¨: (ì ìˆ˜)/5ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

3. ê°œì¸í™” ë° ìŠ¤í† ë¦¬í…”ë§: (ì ìˆ˜)/4ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

4. ì—”í„°í…Œì¸ë¨¼íŠ¸ ê°€ì¹˜: (ì ìˆ˜)/3ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

5. ê°€ë…ì„± ë° êµ¬ì„±: (ì ìˆ˜)/2ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

6. ì˜ˆì¸¡ ë° ê¸°ëŒ€ê° ì¡°ì„±: (ì ìˆ˜)/5ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

7. ê³µê°ëŒ€ í˜•ì„± ë° ì‹¬ë¦¬ì  ì—°ê²°: (ì ìˆ˜)/4ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

8. ë°ì´í„° í™œìš©ì˜ ì°½ì˜ì„±: (ì ìˆ˜)/3ì 
   - ê¸ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ì¥ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - ë¶€ì •ì  ë¶„ì„: [ì½˜í…ì¸ ì˜ ë‹¨ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„]
   - í‰ê°€ ì›ì¹™ ì ìš© ë° ìµœì¢… ê·¼ê±°: [ë¶„ì„ëœ ì¥ë‹¨ì ì— í‰ê°€ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í–ˆìœ¼ë©°, ê·¸ ê²°ê³¼ ì™œ ì´ ì ìˆ˜ë¥¼ ë¶€ì—¬í–ˆëŠ”ì§€ ìµœì¢… ê²°ë¡  ì„œìˆ ]

**ì´ì : (ì ìˆ˜)/32ì **

**ì¢…í•© ì˜ê²¬:**
- ì „ì²´ì  ê°•ì : [3ê°€ì§€]
- ì£¼ìš” ê°œì„  ì˜ì—­: [3ê°€ì§€]
- ìš°ì„  ê°œì„  ì‚¬í•­: [1-2ê°€ì§€]
"""
    return prompt


def extract_total_score(response_text):
    """ì‘ë‹µì—ì„œ ì´ì  ì¶”ì¶œ"""
    pattern = r"\*\*ì´ì :\s*(\d+(?:\.\d+)?)/32\*\*"
    match = re.search(pattern, response_text)

    if match:
        return int(match.group(1))

    # ëŒ€ì•ˆ íŒ¨í„´ë“¤ ì‹œë„
    patterns = [
        r"ì´ì :\s*(\d+(?:\.\d+)?)/32",
        r"ì´ì \s*(\d+(?:\.\d+)?)/32",
        r"ì´ì :\s*(\d+(?:\.\d+)?)",
        r"ì´ì \s*(\d+(?:\.\d+)?)",
    ]

    for pattern in patterns:
        match = re.search(pattern, response_text)
        if match:
            return int(match.group(1))

    print(f"ì ìˆ˜ ì¶”ì¶œ ì‹¤íŒ¨: {response_text[:200]}...")
    return None


def evaluate_single_sample(sample_data, retry_count=3):
    """ë‹¨ì¼ ìƒ˜í”Œ í‰ê°€"""
    prompt = create_evaluation_prompt(sample_data)

    for attempt in range(retry_count):
        try:
            response = model.generate_content(prompt)
            print("\ní‰ê°€ë‚´ìš©:\n", response.text)
            score = extract_total_score(response.text)

            if score is not None:
                return score, response.text
            else:
                print(f"ì ìˆ˜ ì¶”ì¶œ ì‹¤íŒ¨ (ì‹œë„ {attempt + 1}/{retry_count})")

        except Exception as e:
            print(f"API í˜¸ì¶œ ì‹¤íŒ¨ (ì‹œë„ {attempt + 1}/{retry_count}): {e}")
            time.sleep(2)  # ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„

    return None, None


# íŒŒì¼ëª… ìƒì„± í•¨ìˆ˜
def generate_filename(test_name):
    """ë‚ ì§œì™€ ì‹œê°„ì´ í¬í•¨ëœ íŒŒì¼ëª… ìƒì„±"""
    results_dir = "app-report/test/llm-judge/results"
    os.makedirs(results_dir, exist_ok=True)
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"{test_name}_{timestamp}.txt"
    return os.path.join(results_dir, filename)


# TXT íŒŒì¼ë¡œ ê²°ê³¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
def save_results_to_txt(results, detailed_responses, filename, test_type):
    """ê²°ê³¼ë¥¼ TXT íŒŒì¼ë¡œ ì €ì¥"""
    with open(filename, "w", encoding="utf-8") as f:
        # í—¤ë” ì •ë³´
        f.write(f"=== {test_type} ê²°ê³¼ ===\n")
        f.write(
            f"ìƒì„± ë‚ ì§œ: {datetime.now().strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„ %Sì´ˆ')}\n"
        )
        f.write("=" * 80 + "\n\n")

        # ê° í‰ê°€ì˜ ìƒì„¸ ë‚´ìš©
        f.write("=== í‰ê°€ ìƒì„¸ ë‚´ìš© ===\n\n")
        for key, response_text in detailed_responses.items():
            f.write(f"[{key}]\n")
            f.write("-" * 60 + "\n")
            f.write(response_text)
            f.write("\n" + "=" * 80 + "\n\n")

        # ê²°ê³¼ ìš”ì•½ í…Œì´ë¸”
        f.write("=== ê²°ê³¼ ìš”ì•½ ===\n\n")
        df = pd.DataFrame(results).T
        f.write(df.to_string())
        f.write("\n\n")

        # í†µê³„ ì •ë³´
        f.write("=== í†µê³„ ì •ë³´ ===\n")
        for model_name in df.index:
            valid_scores = [score for score in df.loc[model_name] if score is not None]
            if valid_scores:
                avg_score = sum(valid_scores) / len(valid_scores)
                max_score = max(valid_scores)
                min_score = min(valid_scores)
                f.write(
                    f"{model_name}: í‰ê·  {avg_score:.2f}ì , ìµœê³  {max_score}ì , ìµœì € {min_score}ì \n"
                )


def run_test_1():
    """í…ŒìŠ¤íŠ¸ 1: 30ê°œ í›„ë³´ ê°ê° 1ë²ˆì”© í‰ê°€"""
    print("=== í…ŒìŠ¤íŠ¸ 1: ì „ì²´ í›„ë³´ í‰ê°€ ì‹œì‘ ===")

    results = {}
    detailed_responses = {}  # ì¶”ê°€: ìƒì„¸ í‰ê°€ ë‚´ìš© ì €ì¥ìš©

    for model_name, samples in SAMPLE_NEWS.items():
        print(f"\n{model_name.upper()} ëª¨ë¸ í‰ê°€ ì¤‘...")
        results[model_name] = {}

        for i, sample in enumerate(samples, 1):
            print(f"  í›„ë³´{i} í‰ê°€ ì¤‘... ({sample['id']})")

            score, full_response = evaluate_single_sample(sample)
            results[model_name][f"í›„ë³´{i}"] = score

            # ì¶”ê°€: ìƒì„¸ ì‘ë‹µ ì €ì¥
            key = f"{model_name}/í›„ë³´{i}"
            detailed_responses[key] = full_response if full_response else "í‰ê°€ ì‹¤íŒ¨"

            if score is None:
                print(f"    âŒ í‰ê°€ ì‹¤íŒ¨")
            else:
                print(f"    âœ… ì ìˆ˜: {score}/32\n")

            # API í˜¸ì¶œ ê°„ê²© ì¡°ì ˆ
            time.sleep(1)

    # ê²°ê³¼ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜
    df = pd.DataFrame(results).T

    print("\n=== í…ŒìŠ¤íŠ¸ 1 ê²°ê³¼ ===")
    print(df)

    # í†µê³„ ì •ë³´ ì¶”ê°€
    print(f"\n=== ëª¨ë¸ë³„ í‰ê·  ì ìˆ˜ ===")
    for model_name in df.index:
        valid_scores = [score for score in df.loc[model_name] if score is not None]
        if valid_scores:
            avg_score = sum(valid_scores) / len(valid_scores)
            print(f"{model_name}: {avg_score:.2f}ì ")

    # ìˆ˜ì •: TXT íŒŒì¼ë¡œ ì €ì¥
    filename = generate_filename("test1_results")
    save_results_to_txt(
        results, detailed_responses, filename, "í…ŒìŠ¤íŠ¸ 1: ì „ì²´ í›„ë³´ í‰ê°€"
    )
    print(f"\nê²°ê³¼ê°€ '{filename}'ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")

    return df


def run_test_2():
    """í…ŒìŠ¤íŠ¸ 2: ê° ëª¨ë¸ë³„ í›„ë³´1ì— ëŒ€í•´ 10íšŒ ë°˜ë³µ í‰ê°€"""
    print("\n=== í…ŒìŠ¤íŠ¸ 2: ë°˜ë³µ í‰ê°€ ì‹ ë¢°ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘ ===")

    results = {}
    detailed_responses = {}  # ì¶”ê°€: ìƒì„¸ í‰ê°€ ë‚´ìš© ì €ì¥ìš©

    for model_name, samples in SAMPLE_NEWS.items():
        print(f"\n{model_name.upper()} ëª¨ë¸ í‰ê°€ ì¤‘...")

        # í›„ë³´ 1ë§Œ í…ŒìŠ¤íŠ¸
        for candidate_num in range(1, 2):
            sample = samples[candidate_num - 1]  # 0-indexed
            row_key = f"{model_name}/í›„ë³´{candidate_num}"
            results[row_key] = {}

            print(f"  {row_key} í‰ê°€ ì¤‘... ({sample['id']})")

            # 10íšŒ ë°˜ë³µ í‰ê°€
            for repeat in range(1, 11):
                print(f"    ë°˜ë³µ {repeat}/10...")

                score, full_response = evaluate_single_sample(sample)
                results[row_key][f"ë°˜ë³µ{repeat}"] = score

                # ì¶”ê°€: ìƒì„¸ ì‘ë‹µ ì €ì¥
                detail_key = f"{row_key}/ë°˜ë³µ{repeat}"
                detailed_responses[detail_key] = (
                    full_response if full_response else "í‰ê°€ ì‹¤íŒ¨"
                )

                if score is None:
                    print(f"      âŒ í‰ê°€ ì‹¤íŒ¨")
                else:
                    print(f"      âœ… ì ìˆ˜: {score}/32")

                # API í˜¸ì¶œ ê°„ê²© ì¡°ì ˆ
                time.sleep(1)

    # ê²°ê³¼ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜
    df = pd.DataFrame(results).T

    print("\n=== í…ŒìŠ¤íŠ¸ 2 ê²°ê³¼ ===")
    print(df)

    # ê° í›„ë³´ë³„ ì ìˆ˜ ë¶„ì‚° ë¶„ì„
    print(f"\n=== ë°˜ë³µ í‰ê°€ ë¶„ì‚° ë¶„ì„ ===")
    for row_key in df.index:
        scores = [score for score in df.loc[row_key] if score is not None]
        if len(scores) >= 2:
            mean_score = sum(scores) / len(scores)
            variance = sum((score - mean_score) ** 2 for score in scores) / len(scores)
            std_dev = variance**0.5
            print(f"{row_key}: í‰ê·  {mean_score:.2f}ì , í‘œì¤€í¸ì°¨ {std_dev:.2f}")

    # ìˆ˜ì •: TXT íŒŒì¼ë¡œ ì €ì¥
    filename = generate_filename("test2_results")
    save_results_to_txt(
        results, detailed_responses, filename, "í…ŒìŠ¤íŠ¸ 2: ë°˜ë³µ í‰ê°€ ì‹ ë¢°ì„± í…ŒìŠ¤íŠ¸"
    )
    print(f"\nê²°ê³¼ê°€ '{filename}'ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")

    return df


def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    print("ë§¤ì¹­ ë‰´ìŠ¤ í‰ê°€ ì‹œìŠ¤í…œì„ ì‹œì‘í•©ë‹ˆë‹¤...")

    # ì‚¬ìš©ì ì„ íƒ
    print("\nì‹¤í–‰í•  í…ŒìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”:")
    print("1. í…ŒìŠ¤íŠ¸ 1: ì „ì²´ 30ê°œ í›„ë³´ í‰ê°€ (ê° 1íšŒ)")
    print("2. í…ŒìŠ¤íŠ¸ 2: ê° ëª¨ë¸ë³„ í›„ë³´1-3 ë°˜ë³µ í‰ê°€ (ê° 3íšŒ)")
    print("3. ë‘˜ ë‹¤ ì‹¤í–‰")

    choice = input("ì„ íƒ (1, 2, 3): ").strip()

    if choice in ["1", "3"]:
        test1_results = run_test_1()

    if choice in ["2", "3"]:
        test2_results = run_test_2()

    print("\nëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")


if __name__ == "__main__":
    main()
